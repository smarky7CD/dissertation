% Attack Interface
%-------------------------------------------------------------------------------
\begin{figure}[h]
    \centering
   
       \begin{pchstack}[boxed,center,space=0.5em]
       
       \begin{pcvstack}[space=0.45em]
           \procedure[linenumbering, headlinecmd={\vspace{.1em}\hrule\vspace{.2em}}]{$\Atk{\text{err-fe}[u,v]}_{\struct, \set{U}}(\advA)$}{%
                   \streamvar{S} \gets \emptyset; \key \getsr \keys\\
                   \pub \getsr \Rep_\key(\streamvar{S})\\
                   \mathsf{kv}\gets \top; \mathsf{rv} \gets \top\\ 
                   \pcif u=1: \mathsf{kv} \gets K \\
                   \pcif v=1: \mathsf{rv} \gets \pub\\
                   x \getsr \set{U} \\
   %				(\Gamma,\mathrm{st}) \getsr \advA_1^{\HASHO,\UPO,\QRYO}(x,\mathsf{kv},\mathsf{rv})\\
                   \mathrm{done} \getsr \advA^{\HASHO,\UPO,\QRYO}(x,\mathsf{kv},\mathsf{rv})\\
                   n_x \gets \qry_x(\streamvar{S}) \\
                   \hat{n}_{x} \gets \Qry_K(\pub,\qry_x)\\
                   \pcreturn |\hat{n}_{x} - n_{x}|
           }
       \end{pcvstack}
   
       \begin{pcvstack}[space=0.45em]
           \procedure[linenumbering, headlinecmd={\vspace{.1em}\hrule\vspace{.2em}}]{$\UPO(\up)$}{%
           \pub' \getsr \Up_\key(\pub, \up)\\
           \streamvar{S} \gets \up(\streamvar{S})\\
           \pub \gets \pub'\\
           \pcif v=0 : \pcreturn \top\\
           \pcreturn \pub
       }
   
       \procedure[linenumbering, headlinecmd={\vspace{.1em}\hrule\vspace{.2em}}]{$\QRYO(\qry)$}{%
           \pcreturn \Qry_K(\pub, \qry)
       }
   
       \procedure[linenumbering, headlinecmd={\vspace{.1em}\hrule\vspace{.2em}}]{$\HASHO(X)$}{%
       \pcif X \not\in \set{X} : \pcreturn \bot\\
       \pcif H[X]=\bot \\
       \t H[X] \getsr \set{Y}\\
       \pcreturn H[X]
       }
       \end{pcvstack}
   
       \end{pchstack}
   
   
     \caption[The ERR-FE Attack Model.]{The ERR-FE (ERRor in Frequency Estimation) attack model. When experiment parameter $v=1$ (resp. $v=0$) then the representation is public (resp. private); when $u=1$ (resp. $u=0$) then the structure key~$K$ is rendered public (resp. private). The experiment returns the absolute difference between the true frequency~$n_x$ of an adversarially chosen~$x \in \set{U}$, and the estimated frequency $\hat{n}_x$. The $\HASHO$ oracle computes a random mapping $\set{X}\to\set{Y}$ (i.e., a random oracle), and is implicitly provided to $\Rep$, $\Up$ and $\Qry$.}
     \label{fig:err-fe-exp} 
   \end{figure}
   

   To enable precise reasoning about the correctness of frequency estimators when data streams may depend, in arbitrary ways, on the internal randomness of the data structure, we give a pseudocode description of our attack model in Figure~\ref{fig:err-fe-exp}. The experiment parameters $u,v$ determine whether the adversary~$\advA$ is given $K$ and $\pub$, respectively.  Thus, there are actually four attack models encoded into the experiment.
  
   The adversary is provided a target~$x\in\set{U}$, and given access to oracles that allow it to update the current representation ($\UPO$) ---~in effect, to control the data stream~--- and to make any of the queries permitted by the structure ($\QRYO$). We abuse notation for brevity and write~$\UPO(e)$ to mean an insertion of~$e$ into the structure and~$\QRYO(e)$ to get a point query on~$e$ for some element~$e \in \set{U}$. Note that when~$v=0$, the $\UPO$-oracle leaks nothing about updated representation, so that it remains ``private" throughout the experiment.  The adversary (and, implicitly, $\Rep, \Up, \Qry$) is provided oracle access to a random oracle~$\HASHO \colon \set{X} \to \set{Y}$, for some structure-dependent sets $\set{X},\set{Y}$.  The output of the experiment is the absolute error between the true frequency~$n_x$ of~$x$ in the adversarial data stream, and the structure's estimate~$\hat{n}_x$ of~$n_x$. 
   
   Conventionally, one would define an ``advantage" function over the security experiment, and there are various interesting ways this could be done. As examples, 
   one could parameterize by a threshold function~$T \colon \mathbb{Z}\to\mathbb{Z}$, and have the advantage measure the probability that the value $|\hat{n}_x - n_x| > T(q_U)$; 
   or, one could compare this value to known non-adaptive error guarantees.  As we will not be proving the security of any structures, 
   we use $\ExpErrFe{\struct}{\cdot}{u,v}$ as a precise description of the attack setting.  We will explore lower bounds on the values returned by the experiment,
   for explicit attacks that we give. 
   
   We capture various settings related to the view of the adversary in our attack interface. We have a setting in which the data structure representation is kept private from the adversary, and we also have a setting in which the specific choice of hash functions selected by a particular representation are kept private from the adversary.  These settings can be examined together, separately, or both can be disregarded and the adversary can be given a ``full view''. That is we consider when the both the representation and hash functions are private, when the representation is public and the hash functions are private, when the representation is private and the hash functions are public, and when both the representation and hash functions are public.
   
   In practice the private representation setting occurs due to suppression of information leaked by the oracles. In particular in this setting, the $\REPO$ and $\UPO$ oracles return nothing, thus leaking nothing about the underlying data representation. Further, we make hash functions ``private'' by keying them with a (non-empty) randomly generated secret key. 
   